---
title: S3 adapter
description: Use existing S3 tooling with Basin.
---

import { Callout, Steps } from "nextra/components";

The `basin_s3` adapter is a simple S3-compatible adapter that allows you to use the Basin object
storage system with S3-compatibility. Let's walk through how to set it up and use it with something
like MinIO.

### Setup

<Steps>
  
### Install

First, clone the repo:

```sh
git clone https://github.com/hokunet/basin-s3
```

Then, install the adapter binary:

```sh
cargo install --path lib/basin_s3 --features="binary"
```

This should make `basin_s3` available in your path.

### Run the adapter

Starting the Basin S3 adapter uses port `8014` by default. There are three required flags:

- `--private-key`: Hex encoded, Ethereum-style private key (ECDSA, secp256k1) for sending
  transactions (environment variable: `PRIVATE_KEY`).
- `--network`: The network to connect to (environment variable: `NETWORK`).
- `--access-key`: An S3 access key (e.g,. `AKEXAMPLES3S`)
- `--secret-key`: An S3 secret key (e.g., `SKEXAMPLES3S`)

```sh
basin_s3 --private-key [your_private_key] --access-key AKEXAMPLES3S --secret-key SKEXAMPLES3S
```

The access key and secret aren't used for anything other than matching the MinIO client
configuration. If you want to do read-only queries, simply omit the private key. Alternatvely, you
can run it directly with `cargo run`:

```sh
cargo run --features binary -- --private-key [your_private_key] --access-key AKEXAMPLES3S --secret-key SKEXAMPLES3S
```

<Callout type="info">

If you do not already have a private key, you can generate one with the Hoku CLI. You also _must_
make sure your account exists on the subnet, which requires you have deposited funds into your
subnet account. Neglecting this step will lead to errors like
`failed to init sequence; actor ... cannot be found`.

</Callout>

### Run the S3 client

You can now use an S3-compatible client like MinIO to interact with Basin. First, make sure you have
the MinIO client installed, such as with Homebrew on Mac:

```sh
brew install minio/stable/mc
```

Then, add Basin as an alias to the MinIO configuration, and be sure to specify the API version as
`S3v4`. The URL shown below is the default port for the adapter, but you can change it by specifying
the `--address` flag.

```sh
mc alias set basin http://localhost:8014 AKEXAMPLES3S SKEXAMPLES3S --api S3v4
```

You can verify the alias was set properly with `mc alias list`:

```
basin
  URL       : http://localhost:8014
  AccessKey : AKEXAMPLES3S
  SecretKey : SKEXAMPLES3S
  API       : s3v4
  Path      : auto
```

### Create a bucket

Now, you can directly use MinIO to write or read data! Start by creating a bucket:

```
mc mb basin/my-store
```

This will create the bucket called `my-store` under your `basin` alias.

<Callout type="warning">

Bucket usage slightly deviates from how you typically would in S3. This happens due to how the S3
adapter works alongside Basin by using metadata to help identify the MinIO bucket name and its
relationship with onchain buckets owned by the creator. To interact with any bucket, the name you
define is always prefixed by the creator's hex address, delimited by a period.

The general format is `<0x_address>.<bucket_name>`, as shown in the example below.

</Callout>

### Check the bucket name

You can check the buckets under your alias with `mc ls basin`. This will list the bucket above with
the name we used:

```
[2024-11-20 21:18:07 EST]     0B my-store/
```

However, **this is not the bucket name**! The actual bucket name you'll use looks something like
this:

```
0x90f79bf6eb2c4f870365e785982e1f101e93b906.my-store
```

The `0x90f7...` is the public key of the creator (i.e., the private key you used to start the
adapter), and `my-store` is the bucket name we defined earlier.

### Write & read data

You can write to the address that identifies the bucket, where you'd replace `t2pl...` with your
system-defined bucket name:

```
mc put ./test.txt basin/0x90f79bf6eb2c4f870365e785982e1f101e93b906.my-store/world
```

Then, you can read the data back via stdout, or download it to a file:

```
mc cat basin/0x90f79bf6eb2c4f870365e785982e1f101e93b906.my-store/world
mc get basin/0x90f79bf6eb2c4f870365e785982e1f101e93b906.my-store/world ./downloaded-test.txt
```

</Steps>

## Next steps

You can now use Basin with any S3-compatible tooling! This example walked through showed how to use
it with some S3-compatible CLI tool, but its compatibility extends to any S3-compatible client or
library (e.g., [ClickHouse](https://clickhouse.com/), etc.).

We also created a demo video on how to do this, too!

{/* TODO: update with newest release; fix video formatting issues on resize */}

<div className="w-full">
  <br />
  <iframe
    className="w-full aspect-video"
    width="100%"
    height="500px"
    title="Hoku CLI"
    src="https://drive.google.com/file/d/1Kou_jeFg3HgAAMBI8vvvAHLXl0yge-zV/preview"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowFullScreen
  />
</div>
